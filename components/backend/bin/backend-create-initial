#!/usr/bin/env python3

from typing import List
from datetime import datetime
from backend.data.db.results import RegistroSensor, Sensor
from backend.data.config import BackendConfiguration
from backend.data.db import Esquema
from backend.service import SensorService, RegistroSensorService, RegistroPlantaService, RegistroTipoPlantaService, SensorPlantaService
from common.data import TipoSensor, ZonaSensor, RegistroPlanta as RegistroPlantaCommon, RegistroTipoPlanta as RegistroTipoPlantaCommon
from common.data import Sensor as SensorCommon, RegistroSensor as RegistroSensorCommon, SensorPlanta as SensorPlantaCommon

cfg: BackendConfiguration = BackendConfiguration()
#cfg.load_from_file(cfg.default_config_file())
db: Esquema = Esquema(cfg)

#datos de inicializacion del sistema
tipo_planta_ninguno = RegistroTipoPlantaService.create(db,"Ninguno","Sin descripcion")
planta_vacia = RegistroPlantaService.create(db,"Sin planta","Ninguno",None,None)

sensor_humedad_ambiente_1 = SensorService.create(db,TipoSensor.HUMEDAD,ZonaSensor.AMBIENTE,1,"DHT11",patilla_1_lectura=19)
sensor_temperatura_ambiente_1 = SensorCommon(TipoSensor.TEMPERATURA,ZonaSensor.AMBIENTE,1,"DHT11",patilla_1_lectura=19)
sensor_temperatura_ambiente_1 =SensorService.createFromCommon(db,sensor_temperatura_ambiente_1)

tipo_planta_tomatera = RegistroTipoPlantaCommon("Tomatera","Planta facil de cultivar")
tipo_planta_tomatera = RegistroTipoPlantaService.createFromCommon(db,tipo_planta_tomatera)
planta_mi_tomatera = RegistroPlantaCommon("Mi tomatera","Tomatera")
planta_mi_tomatera = RegistroPlantaService.createFromCommon(db,planta_mi_tomatera)

sensor_humedad_maceta_1 = SensorService.create(db,TipoSensor.HUMEDAD,ZonaSensor.MACETA,1,"SIN_MODELO",patilla_1_lectura=20)

sensor_planta_1 = SensorPlantaService.createRelationFromCommon(db,sensor_humedad_ambiente_1,planta_mi_tomatera)
sensor_planta_2 = SensorPlantaService.createRelationFromCommon(db,sensor_temperatura_ambiente_1,planta_mi_tomatera)

RegistroSensorService.create(db,TipoSensor.HUMEDAD,ZonaSensor.AMBIENTE,1,65.0, "%")
RegistroSensorService.create(db,TipoSensor.HUMEDAD,ZonaSensor.MACETA,1,65.0,"%")
RegistroSensorService.create(db,TipoSensor.TEMPERATURA,ZonaSensor.AMBIENTE,1,29.0,"ºC")
RegistroSensorService.create(db,TipoSensor.TEMPERATURA,ZonaSensor.AMBIENTE,1,29.0,"ºC")

RegistroSensorService.createFromCommon(db,sensor_humedad_ambiente_1.crearRegistroSensor(75.0,"%"))
RegistroSensorService.createFromCommon(db,sensor_temperatura_ambiente_1.crearRegistroSensor(19.0,"ºC"))